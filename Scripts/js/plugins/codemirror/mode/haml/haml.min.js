(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],n):n(CodeMirror)})(function(n){"use strict";n.defineMode("haml",function(t){function e(n){return function(t,r){var u=t.peek();return u==n&&r.rubyState.tokenize.length==1?(t.next(),r.tokenize=f,"closeAttributeTag"):i(t,r)}}function i(n,t){return n.match("-#")?(n.skipToEnd(),"comment"):u.token(n,t.rubyState)}function f(n,t){var u=n.peek();if(t.previousToken.style=="comment"&&t.indented>t.previousToken.indented)return n.skipToEnd(),"commentLine";if(t.startOfLine){if(u=="!"&&n.match("!!"))return n.skipToEnd(),"tag";if(n.match(/^%[\w:#\.]+=/))return t.tokenize=i,"hamlTag";if(n.match(/^%[\w:]+/))return"hamlTag";if(u=="/")return n.skipToEnd(),"comment"}if((t.startOfLine||t.previousToken.style=="hamlTag")&&(u=="#"||u=="."))return n.match(/[\w-#\.]*/),"hamlAttribute";if(t.startOfLine&&!n.match("-->",!1)&&(u=="="||u=="-"))return t.tokenize=i,t.tokenize(n,t);if(t.previousToken.style=="hamlTag"||t.previousToken.style=="closeAttributeTag"||t.previousToken.style=="hamlAttribute"){if(u=="(")return t.tokenize=e(")"),t.tokenize(n,t);if(u=="{")return t.tokenize=e("}"),t.tokenize(n,t)}return r.token(n,t.htmlState)}var r=n.getMode(t,{name:"htmlmixed"}),u=n.getMode(t,"ruby");return{startState:function(){var n=r.startState(),t=u.startState();return{htmlState:n,rubyState:t,indented:0,previousToken:{style:null,indented:0},tokenize:f}},copyState:function(t){return{htmlState:n.copyState(r,t.htmlState),rubyState:n.copyState(u,t.rubyState),indented:t.indented,previousToken:t.previousToken,tokenize:t.tokenize}},token:function(n,t){var r,u;return(n.sol()&&(t.indented=n.indentation(),t.startOfLine=!0),n.eatSpace())?null:(r=t.tokenize(n,t),t.startOfLine=!1,r&&r!="commentLine"&&(t.previousToken={style:r,indented:t.indented}),n.eol()&&t.tokenize==i&&(n.backUp(1),u=n.peek(),n.next(),u&&u!=","&&(t.tokenize=f)),r=="hamlTag"?r="tag":r=="commentLine"?r="comment":r=="hamlAttribute"?r="attribute":r=="closeAttributeTag"&&(r=null),r)}}},"htmlmixed","ruby");n.defineMIME("text/x-haml","haml")});
//# sourceMappingURL=haml.min.js.map